{
  try {
    database.getJdbcTemplate().comment("Changeset " + toString());
    if (StringUtils.trimToNull(getComments()) != null) {
      String comments=getComments();
      String[] lines=comments.split("\n");
      for (int i=0; i < lines.length; i++) {
        if (i > 0) {
          lines[i]=database.getLineComment() + " " + lines[i];
        }
      }
      database.getJdbcTemplate().comment(StringUtils.join(Arrays.asList(lines),"\n"));
    }
    for (    Change change : changes) {
      try {
        change.setUp();
      }
 catch (      SetupException se) {
        throw new MigrationFailedException(this,se);
      }
    }
    log.finest("Reading ChangeSet: " + toString());
    for (    Change change : getChanges()) {
      change.executeStatements(database);
      log.finest(change.getConfirmationMessage());
    }
    database.commit();
    log.finest("ChangeSet " + toString() + " has been successfully ran.");
    database.commit();
  }
 catch (  Exception e) {
    try {
      database.rollback();
    }
 catch (    Exception e1) {
      throw new MigrationFailedException(this,e);
    }
    throw new MigrationFailedException(this,e);
  }
}
