{
  updateListeners("Reading foreign keys for " + database.toString() + " ...");
  for (  Table table : tablesMap.values()) {
    ResultSet rs=databaseMetaData.getExportedKeys(database.getCatalogName(),database.getSchemaName(),table.getName());
    while (rs.next()) {
      ForeignKey fkInfo=new ForeignKey();
      String pkTableName=rs.getString("PKTABLE_NAME");
      String pkColumn=rs.getString("PKCOLUMN_NAME");
      Table pkTable=tablesMap.get(pkTableName);
      if (pkTable == null) {
        throw new JDBCException("Could not find table " + pkTableName + " for column "+ pkColumn);
      }
      fkInfo.setPrimaryKeyTable(pkTable);
      fkInfo.setPrimaryKeyColumn(pkColumn);
      String fkTableName=rs.getString("FKTABLE_NAME");
      String fkColumn=rs.getString("FKCOLUMN_NAME");
      Table fkTable=tablesMap.get(fkTableName);
      if (fkTable == null) {
        throw new JDBCException("Could not find table " + fkTableName + " for column "+ fkColumn);
      }
      fkInfo.setForeignKeyTable(fkTable);
      fkInfo.setForeignKeyColumn(fkColumn);
      fkInfo.setName("FK_NAME");
      if (database.supportsInitiallyDeferrableColumns()) {
        short deferrablility=rs.getShort("DEFERRABILITY");
        if (deferrablility == DatabaseMetaData.importedKeyInitiallyDeferred) {
          fkInfo.setDeferrable(Boolean.TRUE);
          fkInfo.setInitiallyDeferred(Boolean.TRUE);
        }
 else         if (deferrablility == DatabaseMetaData.importedKeyInitiallyImmediate) {
          fkInfo.setDeferrable(Boolean.TRUE);
          fkInfo.setInitiallyDeferred(Boolean.FALSE);
        }
 else         if (deferrablility == DatabaseMetaData.importedKeyNotDeferrable) {
          fkInfo.setDeferrable(Boolean.FALSE);
          fkInfo.setInitiallyDeferred(Boolean.FALSE);
        }
      }
      foreignKeys.add(fkInfo);
    }
    rs.close();
  }
}
