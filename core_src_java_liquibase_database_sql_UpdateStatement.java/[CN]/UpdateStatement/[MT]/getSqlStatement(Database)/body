{
  StringBuffer sql=new StringBuffer("UPDATE " + database.escapeTableName(getSchemaName(),getTableName()) + " SET");
  for (  String column : newColumnValues.keySet()) {
    sql.append(" ").append(column).append(" = ");
    Object newValue=newColumnValues.get(column);
    if (newValue == null) {
      sql.append("NULL");
    }
 else     if (newValue instanceof String && database.shouldQuoteValue(((String)newValue))) {
      sql.append("'").append(newValue).append("'");
    }
 else     if (newValue instanceof Date) {
      sql.append(database.getDateLiteral(((Date)newValue)));
    }
 else     if (newValue instanceof Boolean) {
      if (((Boolean)newValue)) {
        sql.append(database.getTrueBooleanValue());
      }
 else {
        sql.append(database.getFalseBooleanValue());
      }
    }
 else {
      sql.append(newValue);
    }
    sql.append(",");
  }
  sql.deleteCharAt(sql.lastIndexOf(","));
  if (whereClause != null) {
    String fixedWhereClause="WHERE " + whereClause;
    for (    Object param : whereParameters) {
      fixedWhereClause=fixedWhereClause.replaceFirst("\\?","'" + param + "'");
    }
    sql.append(" ").append(fixedWhereClause);
  }
  return sql.toString();
}
