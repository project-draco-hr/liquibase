{
  try {
    if (!database.doesChangeLogLockTableExist()) {
      return new DatabaseChangeLogLock[0];
    }
    List<DatabaseChangeLogLock> allLocks=new ArrayList<DatabaseChangeLogLock>();
    RawSqlStatement sqlStatement=new RawSqlStatement((("SELECT ID, LOCKED, LOCKGRANTED, LOCKEDBY FROM " + database.escapeTableName(database.getDefaultSchemaName(),database.getDatabaseChangeLogLockTableName()))));
    List<Map> rows=database.getJdbcTemplate().queryForList(sqlStatement,new ArrayList<SqlStatementVisitor>());
    for (    Map columnMap : rows) {
      Object lockedValue=columnMap.get("LOCKED");
      Boolean locked;
      if (lockedValue instanceof Number) {
        locked=((Number)lockedValue).intValue() == 1;
      }
 else {
        locked=(Boolean)lockedValue;
      }
      if (locked != null && locked) {
        allLocks.add(new DatabaseChangeLogLock(((Number)columnMap.get("ID")).intValue(),(Date)columnMap.get("LOCKGRANTED"),(String)columnMap.get("LOCKEDBY")));
      }
    }
    return allLocks.toArray(new DatabaseChangeLogLock[allLocks.size()]);
  }
 catch (  Exception e) {
    throw new LockException(e);
  }
}
