{
  try {
    if (url.equals("/favicon.ico")) {
      httpServletResponse.setStatus(HttpServletResponse.SC_NOT_FOUND);
      request.setHandled(true);
    }
 else     if (url.equals("/index.html") || url.equals("/") || url.equals("")) {
      Map<String,Object> context=new HashMap<String,Object>();
      this.loadIndexData(context);
      httpServletResponse.setContentType("text/html");
      httpServletResponse.setStatus(HttpServletResponse.SC_OK);
      TemplateService.getInstance().write("liquibase/sdk/watch/index.html.vm",httpServletResponse.getWriter(),context);
      request.setHandled(true);
    }
 else     if (url.equals("/liquibase-status.json")) {
      LockService lockService=LockServiceFactory.getInstance().getLockService(database);
      lockService.waitForLock();
      List<Map<String,?>> rows;
      try {
        SelectFromDatabaseChangeLogStatement select=new SelectFromDatabaseChangeLogStatement("COUNT(*) AS ROW_COUNT","MAX(DATEEXECUTED) AS LAST_EXEC");
        rows=executor.queryForList(select);
      }
  finally {
        lockService.releaseLock();
      }
      PrintWriter writer=httpServletResponse.getWriter();
      httpServletResponse.setContentType("application/json");
      httpServletResponse.setStatus(HttpServletResponse.SC_OK);
      if (rows.size() == 0) {
        writer.print("{'count': 0}");
      }
 else {
        Map<String,?> row=rows.iterator().next();
        writer.print("{\"count\":" + row.get("ROW_COUNT") + ", \"lastExec\": \""+ new ISODateFormat().format((Date)row.get("LAST_EXEC"))+ "\"}");
      }
      request.setHandled(true);
    }
  }
 catch (  Throwable e) {
    throw new ServletException(e);
  }
}
