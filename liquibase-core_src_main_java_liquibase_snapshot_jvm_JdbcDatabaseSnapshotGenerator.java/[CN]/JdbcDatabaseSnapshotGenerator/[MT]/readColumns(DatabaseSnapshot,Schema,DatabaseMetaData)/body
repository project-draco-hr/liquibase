{
  Database database=snapshot.getDatabase();
  updateListeners("Reading columns for " + database.toString() + " ...");
  ResultSet allColumnsMetadataRs=null;
  try {
    allColumnsMetadataRs=databaseMetaData.getColumns(schema.getCatalogName(snapshot.getDatabase()),schema.getName(snapshot.getDatabase()),null,null);
    while (allColumnsMetadataRs.next()) {
      String tableOrViewName=cleanObjectNameFromDatabase(allColumnsMetadataRs.getString("TABLE_NAME"));
      Relation relation=snapshot.getDatabaseObject(schema,tableOrViewName,Table.class);
      if (relation == null) {
        relation=snapshot.getDatabaseObject(schema,tableOrViewName,View.class);
      }
      if (relation == null) {
        if (snapshot.getDatabaseChangeLogTable() != null && snapshot.getDatabaseChangeLogTable().equals(relation)) {
          relation=snapshot.getDatabaseChangeLogTable();
        }
 else         if (snapshot.getDatabaseChangeLogLockTable() != null && snapshot.getDatabaseChangeLogLockTable().equals(relation)) {
          relation=snapshot.getDatabaseChangeLogLockTable();
        }
 else {
          continue;
        }
      }
      Column column=readColumn(allColumnsMetadataRs,relation,database);
      if (column == null) {
        continue;
      }
      relation.getColumns().add(column);
    }
  }
  finally {
    if (allColumnsMetadataRs != null) {
      try {
        allColumnsMetadataRs.close();
      }
 catch (      SQLException ignored) {
      }
    }
  }
}
