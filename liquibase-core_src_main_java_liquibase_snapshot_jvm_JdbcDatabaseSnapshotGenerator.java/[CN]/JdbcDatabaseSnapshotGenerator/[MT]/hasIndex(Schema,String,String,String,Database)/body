{
  try {
    if (tableName == null) {
      ResultSet rs=getMetaData(database).getTables(getJdbcCatalogName(schema),getJdbcSchemaName(schema),null,new String[]{"TABLE"});
      try {
        while (rs.next()) {
          String foundTable=rs.getString("TABLE_NAME");
          if (!database.isSystemTable(schema,foundTable) && !database.isSystemView(schema,foundTable)) {
            if (hasIndex(schema,foundTable,indexName,columnNames,database)) {
              return true;
            }
          }
        }
        return false;
      }
  finally {
        rs.close();
      }
    }
    Index index=new Index();
    index.setTable((Table)new Table(tableName).setSchema(schema));
    index.setName(indexName);
    if (columnNames != null) {
      for (      String column : columnNames.split("\\s*,\\s*")) {
        index.getColumns().add(column);
      }
    }
    if (columnNames != null) {
      Map<String,TreeMap<Short,String>> columnsByIndexName=new HashMap<String,TreeMap<Short,String>>();
      ResultSet rs=getMetaData(database).getIndexInfo(getJdbcCatalogName(schema),getJdbcSchemaName(schema),database.correctObjectName(tableName,Table.class),false,true);
      try {
        while (rs.next()) {
          String foundIndexName=rs.getString("INDEX_NAME");
          if (indexName != null && indexName.equalsIgnoreCase(foundIndexName)) {
            continue;
          }
          short ordinalPosition=rs.getShort("ORDINAL_POSITION");
          if (!columnsByIndexName.containsKey(foundIndexName)) {
            columnsByIndexName.put(foundIndexName,new TreeMap<Short,String>());
          }
          String columnName=rs.getString("COLUMN_NAME");
          Map<Short,String> columns=columnsByIndexName.get(foundIndexName);
          columns.put(ordinalPosition,columnName);
        }
        for (        Map.Entry<String,TreeMap<Short,String>> foundIndexData : columnsByIndexName.entrySet()) {
          Index foundIndex=new Index().setName(foundIndexData.getKey()).setTable(((Table)new Table(tableName).setSchema(schema)));
          foundIndex.getColumns().addAll(foundIndexData.getValue().values());
          if (foundIndex.equals(index,database)) {
            return true;
          }
          return false;
        }
        return false;
      }
  finally {
        rs.close();
      }
    }
 else     if (indexName != null) {
      ResultSet rs=getMetaData(database).getIndexInfo(getJdbcCatalogName(schema),getJdbcSchemaName(schema),database.correctObjectName(tableName,Table.class),false,true);
      try {
        while (rs.next()) {
          Index foundIndex=new Index().setName(rs.getString("INDEX_NAME")).setTable(((Table)new Table(tableName).setSchema(schema)));
          if (foundIndex.getName() == null) {
            continue;
          }
          if (foundIndex.equals(index,database)) {
            return true;
          }
        }
        return false;
      }
  finally {
        try {
          rs.close();
        }
 catch (        SQLException ignore) {
        }
      }
    }
 else {
      throw new UnexpectedLiquibaseException("Either indexName or columnNames must be set");
    }
  }
 catch (  Exception e) {
    throw new UnexpectedLiquibaseException(e);
  }
}
