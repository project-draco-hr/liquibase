{
  DatabaseSnapshot snapshot=new DatabaseSnapshot(database,diffControl.getSchemas(type));
  this.statusListeners=diffControl.getStatusListeners();
  for (  Schema schema : diffControl.getSchemas(type)) {
    schema=snapshot.getDatabase().correctSchema(schema);
    for (    Class clazz : ServiceLocator.getInstance().findClasses(DatabaseObject.class)) {
      DatabaseObjectSnapshotGenerator generator=DatabaseObjectGeneratorFactory.getInstance().getGenerator(clazz,database);
      if (generator != null) {
        updateListeners("Reading objects of type " + clazz.getName() + " from "+ schema);
        DatabaseObject[] objects=generator.get(schema,database);
        if (objects != null) {
          snapshot.addDatabaseObjects(objects);
        }
      }
    }
  }
  return snapshot;
}
