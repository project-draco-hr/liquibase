{
  Database database=snapshot.getDatabase();
  updateListeners("Reading foreign keys for " + database.toString() + " ...");
  String dbSchema=database.convertRequestedSchemaToSchema(schema);
  snapshot.getForeignKeys().addAll(getAdditionalForeignKeys(dbSchema,database));
  for (  Table table : snapshot.getTables()) {
    for (    ForeignKey fk : getForeignKeys(schema,table.getName(),snapshot.getDatabase())) {
      Table tempPKTable=fk.getPrimaryKeyTable();
      Table pkTable=snapshot.getTable(tempPKTable.getName());
      if (pkTable == null) {
        LogFactory.getLogger().warning("Foreign key " + fk.getName() + " references table "+ tempPKTable+ ", which is in a different schema. Retaining FK in diff, but table will not be diffed.");
      }
      Table tempFkTable=fk.getForeignKeyTable();
      Table fkTable=snapshot.getTable(tempFkTable.getName());
      if (fkTable == null) {
        LogFactory.getLogger().warning("Foreign key " + fk.getName() + " is in table "+ tempFkTable+ ", which we cannot find. Ignoring.");
        continue;
      }
      snapshot.getForeignKeys().add(fk);
    }
  }
}
