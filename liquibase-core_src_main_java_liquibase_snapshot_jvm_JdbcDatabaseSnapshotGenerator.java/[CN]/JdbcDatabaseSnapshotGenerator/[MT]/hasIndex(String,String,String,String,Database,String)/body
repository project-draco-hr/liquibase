{
  try {
    if (tableName == null) {
      ResultSet rs=getMetaData(database).getTables(database.correctCatalogName(catalog),database.correctSchemaName(schemaName),null,new String[]{"TABLE"});
      try {
        while (rs.next()) {
          if (hasIndex(catalog,schemaName,rs.getString("TABLE_NAME"),indexName,database,columnNames)) {
            return true;
          }
        }
        return false;
      }
  finally {
        rs.close();
      }
    }
    if (indexName != null) {
      ResultSet rs=getMetaData(database).getIndexInfo(database.correctCatalogName(catalog),database.correctSchemaName(schemaName),database.correctTableName(tableName),false,true);
      try {
        while (rs.next()) {
          if (rs.getString("INDEX_NAME").equals(database.correctIndexName(indexName))) {
            return true;
          }
        }
        return false;
      }
  finally {
        try {
          rs.close();
        }
 catch (        SQLException ignore) {
        }
      }
    }
 else     if (columnNames != null) {
      columnNames=columnNames.replace(" ","");
      if (columnNames.contains(",")) {
        List<String> fixedColumnNames=new ArrayList<String>();
        for (        String columnName : columnNames.split(",")) {
          fixedColumnNames.add(database.correctColumnName(columnName));
        }
        columnNames=StringUtils.join(fixedColumnNames,",");
      }
      Map<String,TreeMap<Short,String>> columnsByIndexName=new HashMap<String,TreeMap<Short,String>>();
      ResultSet rs=getMetaData(database).getIndexInfo(database.correctCatalogName(catalog),database.correctSchemaName(schemaName),database.correctTableName(tableName),false,true);
      try {
        while (rs.next()) {
          String foundIndexName=rs.getString("INDEX_NAME");
          short ordinalPosition=rs.getShort("ORDINAL_POSITION");
          if (!columnsByIndexName.containsKey(foundIndexName)) {
            columnsByIndexName.put(foundIndexName,new TreeMap<Short,String>());
          }
          String columnName=database.correctColumnName(rs.getString("COLUMN_NAME"));
          Map<Short,String> columns=columnsByIndexName.get(foundIndexName);
          columns.put(ordinalPosition,columnName);
        }
        for (        TreeMap<Short,String> columnList : columnsByIndexName.values()) {
          if (StringUtils.join(columnList.values(),",").equals(columnNames)) {
            return true;
          }
        }
        return false;
      }
  finally {
        rs.close();
      }
    }
 else {
      throw new UnexpectedLiquibaseException("Either indexName or columnNames must be set");
    }
  }
 catch (  Exception e) {
    throw new UnexpectedLiquibaseException(e);
  }
}
