{
  LiquibaseProjectComponent liquibaseProjectComponent=LiquibaseProjectComponent.getInstance();
  String rootChangeLog=liquibaseProjectComponent.getRootChangeLog();
  if (rootChangeLog == null) {
    String changeLogFile=new SelectChangeLogDialog().selectChangeLogFile();
    if (changeLogFile == null) {
      return null;
    }
    liquibaseProjectComponent.setRootChangeLog(changeLogFile);
  }
  Migrator migrator=new Migrator(rootChangeLog,new CompositeFileOpener(new IntellijFileOpener(),new FileSystemFileOpener()));
  if (database == null) {
    return migrator;
  }
  try {
    migrator.init(database);
    migrator.checkDatabaseChangeLogTable();
  }
 catch (  Exception e) {
    throw new RuntimeException(e);
  }
  return migrator;
}
