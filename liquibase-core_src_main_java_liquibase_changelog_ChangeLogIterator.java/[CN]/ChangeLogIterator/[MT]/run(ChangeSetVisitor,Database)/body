{
  Logger log=LogFactory.getLogger();
  log.setChangeLog(databaseChangeLog);
  try {
    List<ChangeSet> changeSetList=databaseChangeLog.getChangeSets();
    if (visitor.getDirection().equals(ChangeSetVisitor.Direction.REVERSE)) {
      Collections.reverse(changeSetList);
    }
    for (    ChangeSet changeSet : changeSetList) {
      boolean shouldVisit=true;
      if (changeSetFilters != null) {
        for (        ChangeSetFilter filter : changeSetFilters) {
          if (!filter.accepts(changeSet)) {
            shouldVisit=false;
            break;
          }
        }
      }
      if (shouldVisit) {
        log.setChangeSet(changeSet);
        visitor.visit(changeSet,databaseChangeLog,database);
        log.setChangeSet(null);
      }
    }
  }
  finally {
    log.setChangeLog(null);
  }
}
