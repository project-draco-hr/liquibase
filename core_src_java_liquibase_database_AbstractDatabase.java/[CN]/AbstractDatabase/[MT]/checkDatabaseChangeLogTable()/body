{
  WriteExecutor writeExecutor=ExecutorService.getInstance().getWriteExecutor(this);
  if (!writeExecutor.executesStatements()) {
    if (((LoggingExecutor)writeExecutor).alreadyCreatedChangeTable()) {
      return;
    }
 else {
      ((LoggingExecutor)writeExecutor).setAlreadyCreatedChangeTable(true);
    }
  }
  DatabaseConnection connection=getConnection();
  ResultSet checkColumnsRS=null;
  List<SqlStatement> statementsToExecute=new ArrayList<SqlStatement>();
  boolean changeLogCreateAttempted=false;
  try {
    if (doesChangeLogTableExist()) {
      checkColumnsRS=connection.getMetaData().getColumns(convertRequestedSchemaToCatalog(getDefaultSchemaName()),convertRequestedSchemaToSchema(getDefaultSchemaName()),getDatabaseChangeLogTableName(),null);
      boolean hasDescription=false;
      boolean hasComments=false;
      boolean hasTag=false;
      boolean hasLiquibase=false;
      while (checkColumnsRS.next()) {
        String columnName=checkColumnsRS.getString("COLUMN_NAME");
        if ("DESCRIPTION".equalsIgnoreCase(columnName)) {
          hasDescription=true;
        }
 else         if ("COMMENTS".equalsIgnoreCase(columnName)) {
          hasComments=true;
        }
 else         if ("TAG".equalsIgnoreCase(columnName)) {
          hasTag=true;
        }
 else         if ("LIQUIBASE".equalsIgnoreCase(columnName)) {
          hasLiquibase=true;
        }
      }
      if (!hasDescription) {
        statementsToExecute.add(new AddColumnStatement(getDefaultSchemaName(),getDatabaseChangeLogTableName(),"DESCRIPTION","VARCHAR(255)",null));
      }
      if (!hasTag) {
        statementsToExecute.add(new AddColumnStatement(getDefaultSchemaName(),getDatabaseChangeLogTableName(),"TAG","VARCHAR(255)",null));
      }
      if (!hasComments) {
        statementsToExecute.add(new AddColumnStatement(getDefaultSchemaName(),getDatabaseChangeLogTableName(),"COMMENTS","VARCHAR(255)",null));
      }
      if (!hasLiquibase) {
        statementsToExecute.add(new AddColumnStatement(getDefaultSchemaName(),getDatabaseChangeLogTableName(),"LIQUIBASE","VARCHAR(255)",null));
      }
    }
 else     if (!changeLogCreateAttempted) {
      writeExecutor.comment("Create Database Change Log Table");
      SqlStatement createTableStatement=getCreateChangeLogSQL();
      if (!canCreateChangeLogTable()) {
        throw new JDBCException("Cannot create " + escapeTableName(getDefaultSchemaName(),getDatabaseChangeLogTableName()) + " table for your database.\n\n"+ "Please construct it manually using the following SQL as a base and re-run LiquiBase:\n\n"+ createTableStatement);
      }
      statementsToExecute.add(createTableStatement);
      log.info("Creating database history table with name: " + escapeTableName(getDefaultSchemaName(),getDatabaseChangeLogTableName()));
    }
    for (    SqlStatement sql : statementsToExecute) {
      writeExecutor.execute(sql,new ArrayList<SqlVisitor>());
      this.commit();
    }
  }
 catch (  SQLException e) {
    throw new JDBCException(e);
  }
 finally {
    if (checkColumnsRS != null) {
      try {
        checkColumnsRS.close();
      }
 catch (      SQLException e) {
        throw new JDBCException(e);
      }
    }
  }
}
