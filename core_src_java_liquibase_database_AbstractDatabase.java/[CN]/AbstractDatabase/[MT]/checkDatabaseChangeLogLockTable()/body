{
  boolean knowMustInsertIntoLockTable=false;
  if (!doesChangeLogLockTableExist()) {
    if (!this.getExecutor().executesStatements()) {
      if (((JdbcOutputTemplate)this.getExecutor()).alreadyCreatedChangeLockTable()) {
        return;
      }
 else {
        ((JdbcOutputTemplate)this.getExecutor()).setAlreadyCreatedChangeLockTable(true);
      }
    }
    SqlStatement createTableStatement=getCreateChangeLogLockSQL();
    getExecutor().comment("Create Database Lock Table");
    this.getExecutor().execute(createTableStatement,new ArrayList<SqlVisitor>());
    this.commit();
    log.finest("Created database lock table with name: " + escapeTableName(getDefaultSchemaName(),getDatabaseChangeLogLockTableName()));
    knowMustInsertIntoLockTable=true;
  }
  int rows=-1;
  if (!knowMustInsertIntoLockTable) {
    RawSqlStatement selectStatement=new RawSqlStatement("SELECT COUNT(*) FROM " + escapeTableName(getDefaultSchemaName(),getDatabaseChangeLogLockTableName()) + " WHERE ID=1");
    try {
      rows=this.getExecutor().queryForInt(selectStatement,new ArrayList<SqlVisitor>());
    }
 catch (    JDBCException e) {
      throw e;
    }
  }
  if (knowMustInsertIntoLockTable || rows == 0) {
    this.getExecutor().update(getChangeLogLockInsertSQL(),new ArrayList<SqlVisitor>());
    this.commit();
    log.fine("Inserted lock row into: " + escapeTableName(getDefaultSchemaName(),getDatabaseChangeLogLockTableName()));
  }
}
