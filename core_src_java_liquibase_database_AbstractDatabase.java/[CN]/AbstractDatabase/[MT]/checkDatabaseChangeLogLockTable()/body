{
  boolean knowMustInsertIntoLockTable=false;
  if (!doesChangeLogLockTableExist()) {
    if (!this.getExecutor().executesStatements()) {
      if (((JdbcOutputTemplate)this.getExecutor()).alreadyCreatedChangeLockTable()) {
        return;
      }
 else {
        ((JdbcOutputTemplate)this.getExecutor()).setAlreadyCreatedChangeLockTable(true);
      }
    }
    SqlStatement createTableStatement=getCreateChangeLogLockSQL();
    getExecutor().comment("Create Database Lock Table");
    this.getExecutor().execute(createTableStatement,new ArrayList<SqlVisitor>());
    this.commit();
    log.finest("Created database lock table with name: " + escapeTableName(getDefaultSchemaName(),getDatabaseChangeLogLockTableName()));
    knowMustInsertIntoLockTable=true;
  }
  int rows=-1;
  if (!knowMustInsertIntoLockTable) {
    SqlStatement selectStatement=new SelectFromDatabaseChangeLogLockStatement("COUNT(*)");
    try {
      List<Map> returnList=this.getExecutor().queryForList(selectStatement,new ArrayList<SqlVisitor>());
      if (returnList == null || returnList.size() == 0) {
        rows=0;
      }
 else {
        Map map=returnList.get(0);
        rows=Integer.parseInt(map.values().iterator().next().toString());
      }
    }
 catch (    JDBCException e) {
      throw e;
    }
  }
  if (knowMustInsertIntoLockTable || rows == 0) {
    this.getExecutor().update(getChangeLogLockInsertSQL(),new ArrayList<SqlVisitor>());
    this.commit();
    log.fine("Inserted lock row into: " + escapeTableName(getDefaultSchemaName(),getDatabaseChangeLogLockTableName()));
  }
}
