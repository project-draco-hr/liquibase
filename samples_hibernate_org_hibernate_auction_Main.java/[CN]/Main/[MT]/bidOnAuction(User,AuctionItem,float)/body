{
  System.out.println("Creating a new bid for auction item: " + item.getId() + " by user: "+ bidder.getId());
  Session s=factory.openSession();
  Transaction tx=null;
  try {
    tx=s.beginTransaction();
    s.lock(item,LockMode.NONE);
    s.lock(bidder,LockMode.NONE);
    Bid bid=new Bid();
    bid.setBidder(bidder);
    bid.setDatetime(new Date());
    bid.setAmount(amount);
    bid.setItem(item);
    bidder.getBids().add(bid);
    item.getBids().add(bid);
    tx.commit();
  }
 catch (  Exception e) {
    if (tx != null)     tx.rollback();
    throw e;
  }
 finally {
    s.close();
  }
}
