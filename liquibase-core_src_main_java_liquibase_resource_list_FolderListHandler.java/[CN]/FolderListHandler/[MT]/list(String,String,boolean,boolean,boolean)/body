{
  File finalDir;
  String resourceUrlPrefix=path;
  if (path.startsWith(baseDirectory.toURI().toString())) {
    path=path.substring(baseDirectory.toURI().toString().length());
  }
  if (relativeToFile == null) {
    finalDir=new File(baseDirectory,path);
  }
 else {
    File relativeFolder=new File(baseDirectory,relativeToFile).getParentFile();
    finalDir=new File(relativeFolder,path);
    resourceUrlPrefix=standardizeName(new File(relativeToFile).getParentFile() + ListHandler.RESOURCE_PATH_SEPERATOR + path);
  }
  if (!finalDir.exists() || !finalDir.isDirectory()) {
    return null;
  }
  return listFileTree(resourceUrlPrefix,finalDir,recursive,includeFiles,includeDirectories);
}
