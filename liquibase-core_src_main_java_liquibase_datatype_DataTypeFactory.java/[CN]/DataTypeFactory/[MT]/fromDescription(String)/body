{
  String dataTypeName=dataTypeDefinition;
  if (dataTypeName.matches(".+\\(.*")) {
    dataTypeName=dataTypeDefinition.replaceFirst("\\s*\\(.*","");
  }
  if (dataTypeName.matches(".+\\{.*")) {
    dataTypeName=dataTypeDefinition.replaceFirst("\\s*\\{.*","");
  }
  boolean primaryKey=false;
  if (dataTypeName.endsWith(" identity")) {
    dataTypeName=dataTypeName.replaceFirst(" identity$","");
    primaryKey=true;
  }
  SortedSet<Class<? extends LiquibaseDataType>> classes=registry.get(dataTypeName.toLowerCase());
  LiquibaseDataType liquibaseDataType=null;
  if (classes == null) {
    liquibaseDataType=new UnknownType(dataTypeName);
  }
 else {
    try {
      liquibaseDataType=classes.iterator().next().newInstance();
    }
 catch (    Exception e) {
      throw new UnexpectedLiquibaseException(e);
    }
  }
  if (liquibaseDataType == null) {
    liquibaseDataType=new UnknownType(dataTypeName);
  }
  if (dataTypeDefinition.matches(".+\\s*\\(.*")) {
    String paramStrings=dataTypeDefinition.replaceFirst(".*?\\(","").replaceFirst("\\).*","");
    String[] params=paramStrings.split(",");
    for (    String param : params) {
      param=StringUtils.trimToNull(param);
      if (param != null) {
        liquibaseDataType.addParameter(param);
      }
    }
  }
  if (dataTypeDefinition.matches(".*\\{.*")) {
    String paramStrings=dataTypeDefinition.replaceFirst(".*?\\{","").replaceFirst("\\}.*","");
    String[] params=paramStrings.split(",");
    for (    String param : params) {
      param=StringUtils.trimToNull(param);
      if (param != null) {
        String[] paramAndValue=param.split(":",2);
        try {
          ObjectUtil.setProperty(liquibaseDataType,paramAndValue[0],paramAndValue[1]);
        }
 catch (        Exception e) {
          throw new RuntimeException("Unknown property " + paramAndValue[0] + " for "+ liquibaseDataType.getClass().getName());
        }
      }
    }
  }
  if (primaryKey && liquibaseDataType instanceof IntType) {
    ((IntType)liquibaseDataType).setAutoIncrement(true);
  }
  if (primaryKey && liquibaseDataType instanceof BigIntType) {
    ((BigIntType)liquibaseDataType).setAutoIncrement(true);
  }
  if (primaryKey && liquibaseDataType instanceof IntType) {
    ((IntType)liquibaseDataType).setAutoIncrement(true);
  }
  if (primaryKey && liquibaseDataType instanceof BigIntType) {
    ((BigIntType)liquibaseDataType).setAutoIncrement(true);
  }
  return liquibaseDataType;
}
