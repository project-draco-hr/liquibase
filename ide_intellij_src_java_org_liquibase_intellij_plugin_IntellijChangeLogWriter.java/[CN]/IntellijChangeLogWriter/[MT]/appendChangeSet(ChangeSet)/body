{
  ApplicationManager.getApplication().runWriteAction(new Runnable(){
    public void run(){
      try {
        DocumentBuilder documentBuilder=createDocumentBuilder();
        VirtualFile file=LiquibaseProjectComponent.getInstance().getChangeLogVirtualFile();
        if (file == null) {
          throw new RuntimeException("Could not find file");
        }
        Document doc;
        if (!file.isValid() || file.getLength() == 0) {
          createEmptyChangeLog(file.getOutputStream(this,new Date().getTime(),new Date().getTime()));
        }
        doc=documentBuilder.parse(file.getInputStream());
        doc.getDocumentElement().appendChild(changeSet.createNode(doc));
        OutputStream outputStream=file.getOutputStream(this,new Date().getTime(),new Date().getTime());
        serializeXML(doc,outputStream);
      }
 catch (      Exception e) {
        throw new RuntimeException(e);
      }
    }
  }
);
}
