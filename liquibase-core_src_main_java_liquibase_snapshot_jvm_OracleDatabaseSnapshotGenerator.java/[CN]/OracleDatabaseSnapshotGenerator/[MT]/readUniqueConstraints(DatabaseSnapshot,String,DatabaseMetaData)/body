{
  Database database=snapshot.getDatabase();
  updateListeners("Reading unique constraints for " + database.toString() + " ...");
  List<UniqueConstraint> foundUC=new ArrayList<UniqueConstraint>();
  Connection jdbcConnection=((JdbcConnection)database.getConnection()).getUnderlyingConnection();
  PreparedStatement statement=null;
  ResultSet rs=null;
  if (schema == null)   schema=database.convertRequestedSchemaToSchema(schema);
  try {
    String query="select uc.constraint_name,uc.table_name,uc.status,uc.deferrable,uc.deferred,ui.tablespace_name from all_constraints uc, all_cons_columns ucc, all_indexes ui where uc.constraint_type='U' and uc.index_name = ui.index_name and uc.constraint_name = ucc.constraint_name and uc.owner = '" + schema + "' and ui.table_owner = '"+ schema+ "' and ucc.owner = '"+ schema+ "'";
    statement=jdbcConnection.prepareStatement(query);
    rs=statement.executeQuery();
    while (rs.next()) {
      String constraintName=rs.getString("constraint_name");
      String tableName=rs.getString("table_name");
      String status=rs.getString("status");
      String deferrable=rs.getString("deferrable");
      String deferred=rs.getString("deferred");
      String tablespace=rs.getString("tablespace_name");
      UniqueConstraint constraintInformation=new UniqueConstraint();
      constraintInformation.setName(constraintName);
      constraintInformation.setTablespace(tablespace);
      if (!database.isSystemTable(null,schema,tableName) && !database.isLiquibaseTable(tableName)) {
        Table table=snapshot.getTable(tableName);
        if (table == null) {
          continue;
        }
        constraintInformation.setTable(table);
        constraintInformation.setDisabled("DISABLED".equals(status));
        if ("DEFERRABLE".equals(deferrable)) {
          constraintInformation.setDeferrable(true);
          constraintInformation.setInitiallyDeferred("DEFERRED".equals(deferred));
        }
        getColumnsForUniqueConstraint(jdbcConnection,constraintInformation,schema);
        foundUC.add(constraintInformation);
      }
    }
    snapshot.getUniqueConstraints().addAll(foundUC);
  }
  finally {
    try {
      rs.close();
    }
 catch (    SQLException ignored) {
    }
    if (statement != null) {
      statement.close();
    }
  }
}
