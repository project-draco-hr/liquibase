{
  DocumentBuilderFactory factory=DocumentBuilderFactory.newInstance();
  factory.setNamespaceAware(true);
  DocumentBuilder documentBuilder;
  try {
    documentBuilder=factory.newDocumentBuilder();
  }
 catch (  ParserConfigurationException e) {
    throw new RuntimeException(e);
  }
  documentBuilder.setEntityResolver(new LiquibaseEntityResolver(this));
  Document doc=documentBuilder.newDocument();
  Element changeLogElement=doc.createElementNS(LiquibaseSerializable.STANDARD_OBJECTS_NAMESPACE,"databaseChangeLog");
  changeLogElement.setAttribute("xmlns",LiquibaseSerializable.STANDARD_OBJECTS_NAMESPACE);
  changeLogElement.setAttribute("xmlns:xsi","http://www.w3.org/2001/XMLSchema-instance");
  Map<String,String> shortNameByNamespace=new HashMap<String,String>();
  Map<String,String> urlByNamespace=new HashMap<String,String>();
  for (  String namespace : ChangeFactory.getInstance().getAllChangeNamespaces()) {
    SerializerNamespaceDetails details=SerializerNamespaceDetailsFactory.getInstance().getNamespaceDetails(this,namespace);
    if (details != null) {
      shortNameByNamespace.put(namespace,details.getShortName(namespace));
      urlByNamespace.put(namespace,details.getSchemaUrl(namespace));
    }
  }
  for (  Map.Entry<String,String> entry : shortNameByNamespace.entrySet()) {
    if (!entry.getValue().equals("")) {
      changeLogElement.setAttribute("xmlns:" + entry.getValue(),entry.getKey());
    }
  }
  String schemaLocationAttribute="";
  for (  Map.Entry<String,String> entry : urlByNamespace.entrySet()) {
    if (!entry.getValue().equals("")) {
      schemaLocationAttribute+=entry.getKey() + " " + entry.getValue()+ " ";
    }
  }
  changeLogElement.setAttribute("xsi:schemaLocation",schemaLocationAttribute.trim());
  doc.appendChild(changeLogElement);
  setCurrentChangeLogFileDOM(doc);
  for (  ChangeSet changeSet : changeSets) {
    doc.getDocumentElement().appendChild(createNode(changeSet));
  }
  new DefaultXmlWriter().write(doc,out);
}
