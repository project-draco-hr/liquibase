{
  FileInputStream in=new FileInputStream(changeLogFile);
  String existingChangeLog=StreamUtil.getStreamContents(in);
  in.close();
  FileOutputStream out=new FileOutputStream(changeLogFile);
  try {
    if (!existingChangeLog.contains("</databaseChangeLog>")) {
      write(Arrays.asList(changeSet),out);
    }
 else {
      existingChangeLog=existingChangeLog.replaceFirst("</databaseChangeLog>",serialize(changeSet,true) + "\n</databaseChangeLog>");
      StreamUtil.copy(new ByteArrayInputStream(existingChangeLog.getBytes()),out);
    }
    out.flush();
  }
  finally {
    out.close();
  }
}
