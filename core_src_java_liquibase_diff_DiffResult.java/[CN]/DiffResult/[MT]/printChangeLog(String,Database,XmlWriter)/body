{
  File file=new File(changeLogFile);
  if (!file.exists()) {
    LogFactory.getLogger().info(file + " does not exist, creating");
    FileOutputStream stream=new FileOutputStream(file);
    printChangeLog(new PrintStream(stream),targetDatabase,xmlWriter);
    stream.close();
  }
 else {
    LogFactory.getLogger().info(file + " exists, appending");
    ByteArrayOutputStream out=new ByteArrayOutputStream();
    printChangeLog(new PrintStream(out),targetDatabase,xmlWriter);
    String xml=new String(out.toByteArray());
    xml=xml.replaceFirst("(?ms).*<databaseChangeLog[^>]*>","");
    xml=xml.replaceFirst("</databaseChangeLog>","");
    xml=xml.trim();
    String lineSeparator=System.getProperty("line.separator");
    BufferedReader fileReader=new BufferedReader(new FileReader(file));
    String line;
    long offset=0;
    while ((line=fileReader.readLine()) != null) {
      int index=line.indexOf("</databaseChangeLog>");
      if (index >= 0) {
        offset+=index;
      }
 else {
        offset+=line.getBytes().length;
        offset+=lineSeparator.getBytes().length;
      }
    }
    fileReader.close();
    fileReader=new BufferedReader(new FileReader(file));
    fileReader.skip(offset);
    System.out.println("line:" + fileReader.readLine());
    fileReader.close();
    RandomAccessFile randomAccessFile=new RandomAccessFile(file,"rw");
    randomAccessFile.seek(offset);
    randomAccessFile.writeBytes("    " + xml + lineSeparator);
    randomAccessFile.writeBytes("</databaseChangeLog>" + lineSeparator);
    randomAccessFile.close();
  }
}
