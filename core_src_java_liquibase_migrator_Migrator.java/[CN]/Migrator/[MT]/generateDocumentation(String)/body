{
  log.info("Generating Database Documentation");
  LockHandler lockHandler=LockHandler.getInstance(database);
  lockHandler.waitForLock();
  try {
    database.checkDatabaseChangeLogTable();
    validate();
    DatabaseChangeLog changeLog=new ChangeLogParser().parse(changeLogFile,fileOpener);
    ChangeLogIterator logIterator=new ChangeLogIterator(changeLog,new DbmsChangeSetFilter(database));
    DBDocVisitor visitor=new DBDocVisitor(database);
    logIterator.run(visitor);
    visitor.writeHTML(new File(outputDirectory),fileOpener);
  }
 catch (  IOException e) {
    throw new LiquibaseException(e);
  }
 finally {
    lockHandler.releaseLock();
  }
}
