{
  CompareControl.SchemaComparison[] schemaComparisons=diffResult.getCompareControl().getSchemaComparisons();
  if (schemaComparisons != null) {
    for (    CompareControl.SchemaComparison schemaComparison : schemaComparisons) {
      for (      T referenceObject : referenceSnapshot.get(type)) {
        Schema referenceObjectSchema=referenceObject.getSchema();
        if (referenceObjectSchema != null && referenceObjectSchema.getName() != null) {
          if (!referenceObjectSchema.getName().equalsIgnoreCase(schemaComparison.getReferenceSchema().getSchemaName())) {
            continue;
          }
        }
        T comparisonObject=comparisonSnapshot.get(referenceObject);
        if (comparisonObject == null) {
          diffResult.addMissingObject(referenceObject);
        }
 else {
          ObjectDifferences differences=DatabaseObjectComparatorFactory.getInstance().findDifferences(referenceObject,comparisonObject,comparisonSnapshot.getDatabase(),diffResult.getCompareControl());
          if (differences.hasDifferences()) {
            diffResult.addChangedObject(referenceObject,differences);
          }
        }
      }
      for (      T comparisonObject : comparisonSnapshot.get(type)) {
        Schema comparisonObjectSchema=comparisonObject.getSchema();
        if (comparisonObjectSchema != null && !comparisonObjectSchema.getName().equalsIgnoreCase(schemaComparison.getComparisonSchema().getSchemaName())) {
          continue;
        }
        if (referenceSnapshot.get(comparisonObject) == null) {
          diffResult.addUnexpectedObject(comparisonObject);
        }
      }
    }
  }
}
