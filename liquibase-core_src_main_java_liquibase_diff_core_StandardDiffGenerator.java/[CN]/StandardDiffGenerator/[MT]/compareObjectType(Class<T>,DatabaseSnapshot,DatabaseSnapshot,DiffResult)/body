{
  for (  DiffControl.SchemaComparison schemaComparison : diffResult.getDiffControl().getSchemaComparisons()) {
    CatalogAndSchema referenceSchema=referenceSnapshot.getDatabase().correctSchema(schemaComparison.getReferenceSchema());
    CatalogAndSchema comparisonSchema=null;
    if (comparisonSnapshot.getDatabase() != null) {
      comparisonSchema=comparisonSnapshot.getDatabase().correctSchema(schemaComparison.getComparisonSchema());
    }
    for (    T referenceObject : referenceSnapshot.get(type)) {
      T comparisonObject=comparisonSnapshot.get(referenceObject);
      if (comparisonObject == null) {
        diffResult.getObjectDiff(type).addMissing(referenceObject);
      }
 else {
        ObjectDifferences differences=DatabaseObjectComparatorFactory.getInstance().findDifferences(referenceObject,comparisonObject,comparisonSnapshot.getDatabase());
        if (differences.hasDifferences()) {
          diffResult.getObjectDiff(type).addChanged(referenceObject,differences);
        }
      }
    }
    for (    T comparisonObject : comparisonSnapshot.get(type)) {
      if (referenceSnapshot.get(comparisonObject) == null) {
        diffResult.getObjectDiff(type).addUnexpected(comparisonObject);
      }
    }
  }
}
