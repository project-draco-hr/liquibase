{
  SnapshotControl snapshotControl=new SnapshotControl(getReferenceDatabase(),getSnapshotTypes());
  DatabaseSnapshot originalDatabaseSnapshot=SnapshotGeneratorFactory.getInstance().createSnapshot(getCompareControl().getSchemas(CompareControl.DatabaseRole.REFERENCE),getReferenceDatabase(),snapshotControl);
  DiffResult diffResult=DiffGeneratorFactory.getInstance().compare(originalDatabaseSnapshot,SnapshotGeneratorFactory.getInstance().createSnapshot(getCompareControl().getSchemas(CompareControl.DatabaseRole.REFERENCE),null,snapshotControl),getCompareControl());
  DiffToChangeLog changeLogWriter=new DiffToChangeLog(diffResult,getDiffOutputControl());
  changeLogWriter.setChangeSetAuthor(author);
  changeLogWriter.setChangeSetContext(context);
  if (StringUtils.trimToNull(getChangeLogFile()) != null) {
    changeLogWriter.print(getChangeLogFile());
  }
 else {
    PrintStream outputStream=getOutputStream();
    if (outputStream == null) {
      outputStream=System.out;
    }
    changeLogWriter.print(outputStream);
  }
  return null;
}
