{
  String shouldRunProperty=System.getProperty(Migrator.SHOULD_RUN_SYSTEM_PROPERTY);
  if (shouldRunProperty != null && !Boolean.valueOf(shouldRunProperty)) {
    getLog().warn("Migrator did not run because '" + Migrator.SHOULD_RUN_SYSTEM_PROPERTY + "' system property was set to false");
    return;
  }
  Connection connection=null;
  try {
    Driver driver=(Driver)Class.forName(getDriver(),true,getClass().getClassLoader()).newInstance();
    Properties info=new Properties();
    info.put("user",getUsername());
    info.put("password",getPassword());
    connection=driver.connect(getUrl(),info);
    if (connection == null) {
      throw new JDBCException("Connection could not be created to " + getUrl() + " with driver "+ driver.getClass().getName()+ ".  Possibly the wrong driver for the given database URL");
    }
    String[] changeLogFiles=getChangeLogFile().split(",");
    for (    String changeLogFile : changeLogFiles) {
      FileOpener mFO=new MavenFileOpener();
      FileOpener fsFO=new FileSystemFileOpener();
      Migrator migrator=new Migrator(changeLogFile.trim(),new CompositeFileOpener(mFO,fsFO));
      migrator.setContexts(getContexts());
      migrator.init(connection);
      if (isPromptOnNonLocalDatabase() && !migrator.isSafeToRunMigration()) {
        if (migrator.swingPromptForNonLocalDatabase()) {
          throw new LiquibaseException("Chose not to run against non-production database");
        }
      }
      if (isDropFirst()) {
        migrator.dropAll();
      }
      migrator.migrate();
    }
  }
 catch (  Exception e) {
    throw new BuildException(e);
  }
 finally {
    if (connection != null) {
      try {
        connection.close();
      }
 catch (      SQLException e) {
        ;
      }
    }
  }
}
