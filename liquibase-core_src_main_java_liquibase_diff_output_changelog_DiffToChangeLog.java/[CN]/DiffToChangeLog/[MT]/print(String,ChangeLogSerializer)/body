{
  File file=new File(changeLogFile);
  if (!file.exists()) {
    LogFactory.getLogger().info(file + " does not exist, creating");
    FileOutputStream stream=new FileOutputStream(file);
    print(new PrintStream(stream),changeLogSerializer);
    stream.close();
  }
 else {
    LogFactory.getLogger().info(file + " exists, appending");
    ByteArrayOutputStream out=new ByteArrayOutputStream();
    print(new PrintStream(out),changeLogSerializer);
    String xml=new String(out.toByteArray());
    xml=xml.replaceFirst("(?ms).*<databaseChangeLog[^>]*>","");
    xml=xml.replaceFirst("</databaseChangeLog>","");
    xml=xml.trim();
    if ("".equals(xml)) {
      LogFactory.getLogger().info("No changes found, nothing to do");
      return;
    }
    RandomAccessFile randomAccessFile=new RandomAccessFile(file,"rw");
    String line;
    long offset=0;
    while ((line=randomAccessFile.readLine()) != null) {
      int index=line.indexOf("</databaseChangeLog>");
      if (index >= 0) {
        break;
      }
 else {
        offset=randomAccessFile.getFilePointer();
      }
    }
    String lineSeparator=LiquibaseConfiguration.getInstance().getConfiguration(GlobalConfiguration.class).getOutputLineSeparator();
    randomAccessFile.seek(offset);
    randomAccessFile.writeBytes("    ");
    randomAccessFile.write(xml.getBytes());
    randomAccessFile.writeBytes(lineSeparator);
    randomAccessFile.writeBytes("</databaseChangeLog>" + lineSeparator);
    randomAccessFile.close();
  }
}
