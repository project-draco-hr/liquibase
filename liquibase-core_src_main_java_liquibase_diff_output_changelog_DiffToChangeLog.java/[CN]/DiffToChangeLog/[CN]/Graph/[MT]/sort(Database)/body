{
  ChangeGeneratorFactory changeGeneratorFactory=ChangeGeneratorFactory.getInstance();
  for (  Class<? extends DatabaseObject> type : allNodes.keySet()) {
    for (    Class<? extends DatabaseObject> afterType : changeGeneratorFactory.runBeforeTypes(type,database)) {
      getNode(type).addEdge(getNode(afterType));
    }
    for (    Class<? extends DatabaseObject> beforeType : changeGeneratorFactory.runAfterTypes(type,database)) {
      getNode(beforeType).addEdge(getNode(type));
    }
  }
  ArrayList<Node> L=new ArrayList<Node>();
  HashSet<Node> S=new HashSet<Node>();
  for (  Node n : allNodes.values()) {
    if (n.inEdges.size() == 0) {
      S.add(n);
    }
  }
  while (!S.isEmpty()) {
    Node n=S.iterator().next();
    S.remove(n);
    L.add(n);
    for (Iterator<Edge> it=n.outEdges.iterator(); it.hasNext(); ) {
      Edge e=it.next();
      Node m=e.to;
      it.remove();
      m.inEdges.remove(e);
      if (m.inEdges.isEmpty()) {
        S.add(m);
      }
    }
  }
  for (  Node n : allNodes.values()) {
    if (!n.inEdges.isEmpty()) {
      throw new UnexpectedLiquibaseException("Cycle present, topological sort not possible");
    }
  }
  List<Class<? extends DatabaseObject>> returnList=new ArrayList<Class<? extends DatabaseObject>>();
  for (  Node node : L) {
    returnList.add(node.type);
  }
  return returnList;
}
