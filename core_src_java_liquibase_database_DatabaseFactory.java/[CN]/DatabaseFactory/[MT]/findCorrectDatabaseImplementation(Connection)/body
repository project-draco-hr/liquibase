{
  Database database=null;
  boolean foundImplementation=false;
  for (  Database implementedDatabase : getImplementedDatabases()) {
    database=implementedDatabase;
    if (database.isCorrectDatabaseImplementation(connection)) {
      foundImplementation=true;
      break;
    }
  }
  if (!foundImplementation) {
    try {
      log.warning("Unknown database: " + connection.getMetaData().getDatabaseProductName());
    }
 catch (    SQLException e) {
      throw new JDBCException(e);
    }
    database=new UnsupportedDatabase();
  }
  database.setConnection(connection);
  return database;
}
