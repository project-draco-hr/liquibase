{
  if (hasChangeLogLock) {
    return true;
  }
  WriteExecutor writeExecutor=ExecutorService.getInstance().getWriteExecutor(database);
  try {
    database.rollback();
    database.checkDatabaseChangeLogLockTable();
    Boolean locked;
    try {
      locked=(Boolean)ExecutorService.getInstance().getReadExecutor(database).queryForObject(new SelectFromDatabaseChangeLogLockStatement("locked"),Boolean.class,new ArrayList<SqlVisitor>());
    }
 catch (    DatabaseException e) {
      if (!writeExecutor.executesStatements()) {
        locked=false;
      }
 else {
        throw new LockException("Error checking database lock status",e);
      }
    }
    if (locked) {
      return false;
    }
 else {
      writeExecutor.comment("Lock Database");
      int rowsUpdated=writeExecutor.update(new LockDatabaseChangeLogStatement(),new ArrayList<SqlVisitor>());
      if (rowsUpdated != 1) {
        if (!writeExecutor.executesStatements()) {
        }
 else {
          throw new LockException("Did not update change log lock correctly");
        }
      }
      database.commit();
      LogFactory.getLogger().info("Successfully acquired change log lock");
      hasChangeLogLock=true;
      return true;
    }
  }
 catch (  Exception e) {
    throw new LockException(e);
  }
 finally {
    try {
      database.rollback();
    }
 catch (    DatabaseException e) {
      ;
    }
  }
}
