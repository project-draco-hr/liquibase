{
  FileOpener antFO=new AntFileOpener(getProject(),classpath);
  FileOpener fsFO=new FileSystemFileOpener();
  Database database=createDatabaseObject(getDriver(),getUrl(),getUsername(),getPassword(),getDefaultSchemaName(),getDatabaseClass());
  String changeLogFile=null;
  if (getChangeLogFile() != null) {
    changeLogFile=getChangeLogFile().trim();
  }
  Liquibase liquibase=new Liquibase(changeLogFile,new CompositeFileOpener(antFO,fsFO),database);
  liquibase.setCurrentDateTimeFunction(currentDateTimeFunction);
  for (  Map.Entry<String,Object> entry : changeLogProperties.entrySet()) {
    liquibase.setChangeLogParameterValue(entry.getKey(),entry.getValue());
  }
  return liquibase;
}
