{
  if (table == null) {
    return null;
  }
  Database database=snapshot.getDatabase();
  Schema schema;
  schema=table.getSchema();
  Set<String> seenFks=new HashSet<String>();
  ResultSet importedKeyMetadataResultSet=null;
  try {
    importedKeyMetadataResultSet=getMetaData(database).getImportedKeys(database.getJdbcCatalogName(schema),database.getJdbcSchemaName(schema),table.getName());
    while (importedKeyMetadataResultSet.next()) {
      ForeignKey fk=new ForeignKey().setName(importedKeyMetadataResultSet.getString("FK_NAME")).setForeignKeyTable(table);
      if (seenFks.add(fk.getName())) {
        table.getOutgoingForeignKeys().add(snapshot.snapshot(fk));
      }
    }
  }
 catch (  Exception e) {
    throw new DatabaseException(e);
  }
 finally {
    if (importedKeyMetadataResultSet != null) {
      try {
        importedKeyMetadataResultSet.close();
      }
 catch (      SQLException ignored) {
      }
    }
  }
  seenFks=new HashSet<String>();
  ResultSet exportedKeyMetadataResultSet=null;
  try {
    exportedKeyMetadataResultSet=getMetaData(database).getExportedKeys(database.getJdbcCatalogName(schema),database.getJdbcSchemaName(schema),table.getName());
    while (exportedKeyMetadataResultSet.next()) {
      ForeignKey fk=new ForeignKey().setName(exportedKeyMetadataResultSet.getString("FK_NAME")).setForeignKeyTable(table);
      if (seenFks.add(fk.getName())) {
        table.getIncomingForeignKeys().add(snapshot.snapshot(fk));
      }
    }
  }
 catch (  Exception e) {
    throw new DatabaseException(e);
  }
 finally {
    if (exportedKeyMetadataResultSet != null) {
      try {
        exportedKeyMetadataResultSet.close();
      }
 catch (      SQLException ignored) {
      }
    }
  }
  return table;
}
