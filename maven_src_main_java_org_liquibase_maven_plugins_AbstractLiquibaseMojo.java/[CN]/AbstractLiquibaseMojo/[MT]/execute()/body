{
  getLog().info("");
  getLog().info("Liquibase Maven Plugin");
  getLog().info(LOG_SEPARATOR);
  String shouldRunProperty=System.getProperty(Migrator.SHOULD_RUN_SYSTEM_PROPERTY);
  if (shouldRunProperty != null && !Boolean.valueOf(shouldRunProperty).booleanValue()) {
    getLog().warn("Migrator did not run because '" + Migrator.SHOULD_RUN_SYSTEM_PROPERTY + "' system property was set to false");
    return;
  }
  ClassLoader artifactClassLoader=null;
  try {
    artifactClassLoader=getArtifactClassloader();
  }
 catch (  MalformedURLException e) {
    throw new MojoExecutionException("Failed to create artifact classloader",e);
  }
  FileOpener mFO=new MavenFileOpener(artifactClassLoader);
  FileOpener fsFO=new FileSystemFileOpener();
  CompositeFileOpener cfo=new CompositeFileOpener(mFO,fsFO);
  if (propertiesFile != null) {
    if (verbose) {
      getLog().info("Loading Liquibase settings from properties file, " + propertiesFile);
    }
    try {
      InputStream is=cfo.getResourceAsStream(propertiesFile);
      parsePropertiesFile(is);
    }
 catch (    IOException e) {
      throw new MojoExecutionException("Failed to resolve properties file",e);
    }
  }
  if (verbose) {
    getLog().info("Settings----------------------------");
    printSettings();
    getLog().info(LOG_SEPARATOR);
  }
  Connection connection=null;
  try {
    Driver dbDriver=(Driver)Class.forName(driver,true,artifactClassLoader).newInstance();
    Properties info=new Properties();
    info.put("user",username);
    info.put("password",password);
    connection=dbDriver.connect(url,info);
    if (connection == null) {
      throw new JDBCException("Connection could not be created to " + url + " with driver "+ dbDriver.getClass().getName()+ ".  Possibly the wrong driver for the given "+ "database URL");
    }
    Migrator migrator=new Migrator(changeLogFile.trim(),cfo);
    migrator.setContexts(contexts);
    migrator.init(connection);
    performMigratorConfiguration(migrator);
    getLog().info("Executing on Database: " + url);
    if (promptOnNonLocalDatabase && !migrator.isSafeToRunMigration()) {
      if (migrator.swingPromptForNonLocalDatabase()) {
        throw new LiquibaseException("Chose not to run against non-production database");
      }
    }
    if (dropFirst) {
      migrator.dropAll();
    }
    performLiquibaseTask(migrator);
  }
 catch (  ClassNotFoundException e) {
    releaseConnection(connection);
    throw new MojoFailureException("Missing Class '" + e.getMessage() + "'. Database "+ "driver may not be included in the project "+ "dependencies or with wrong scope.");
  }
catch (  Exception e) {
    releaseConnection(connection);
    throw new MojoFailureException(e.getMessage());
  }
  getLog().info(LOG_SEPARATOR);
}
