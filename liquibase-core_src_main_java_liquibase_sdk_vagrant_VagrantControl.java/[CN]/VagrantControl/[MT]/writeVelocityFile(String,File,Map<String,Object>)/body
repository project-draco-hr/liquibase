{
  VelocityEngine engine=new VelocityEngine();
  engine.setProperty(RuntimeConstants.RESOURCE_LOADER,"classpath");
  engine.setProperty("classpath.resource.loader.class",ClasspathResourceLoader.class.getName());
  engine.init();
  InputStream input=this.getClass().getClassLoader().getResourceAsStream(templatePath);
  if (input == null) {
    throw new IOException("Template file " + templatePath + " doesn't exist");
  }
  VelocityContext context=new VelocityContext();
  for (  Map.Entry<String,Object> entry : contextParams.entrySet()) {
    context.put(entry.getKey(),entry.getValue());
  }
  Template template=engine.getTemplate(templatePath,"UTF-8");
  outputDir.mkdirs();
  BufferedWriter writer=new BufferedWriter(new FileWriter(new File(outputDir,templatePath.replaceFirst(".*/","").replaceFirst(".vm$",""))));
  template.merge(context,writer);
  writer.flush();
  writer.close();
}
