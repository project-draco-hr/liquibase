{
  DiffControl diffControl=new DiffControl(new DiffControl.SchemaComparison[]{new DiffControl.SchemaComparison(new CatalogAndSchema(catalogName,schemaName),new CatalogAndSchema(catalogName,schemaName))});
  diffControl.setDataDir(dataDir);
  diffControl.addStatusListener(new OutDiffStatusListener());
  DatabaseSnapshot originalDatabaseSnapshot=SnapshotGeneratorFactory.getInstance().createSnapshot(diffControl.getSchemas(DiffControl.DatabaseRole.REFERENCE),originalDatabase,new SnapshotControl(snapshotTypes));
  DiffResult diffResult=DiffGeneratorFactory.getInstance().compare(originalDatabaseSnapshot,SnapshotGeneratorFactory.getInstance().createSnapshot(diffControl.getSchemas(DiffControl.DatabaseRole.REFERENCE),null,new SnapshotControl(snapshotTypes)),diffControl);
  DiffToChangeLog changeLogWriter=new DiffToChangeLog(diffResult,diffOutputConfig);
  changeLogWriter.setChangeSetAuthor(author);
  changeLogWriter.setChangeSetContext(context);
  if (StringUtils.trimToNull(changeLogFile) != null) {
    changeLogWriter.print(changeLogFile);
  }
 else {
    PrintStream outputStream=System.out;
    changeLogWriter.print(outputStream);
  }
}
