{
  DiffControl diffControl=new DiffControl(new CatalogAndSchema(catalogName,schemaName),diffTypes);
  diffControl.setDataDir(dataDir);
  diffControl.addStatusListener(new OutDiffStatusListener());
  DatabaseSnapshot originalDatabaseSnapshot=SnapshotGeneratorFactory.getInstance().createSnapshot(diffControl.getSchemas(DiffControl.DatabaseRole.REFERENCE),originalDatabase,diffControl.toSnapshotControl(DiffControl.DatabaseRole.REFERENCE));
  DiffResult diffResult=DiffGeneratorFactory.getInstance().compare(originalDatabaseSnapshot,SnapshotGeneratorFactory.getInstance().createSnapshot(diffControl.getSchemas(DiffControl.DatabaseRole.REFERENCE),null,diffControl.toSnapshotControl(DiffControl.DatabaseRole.REFERENCE)),diffControl);
  DiffToChangeLog changeLogWriter=new DiffToChangeLog(diffResult,diffOutputConfig);
  changeLogWriter.setChangeSetAuthor(author);
  changeLogWriter.setChangeSetContext(context);
  if (StringUtils.trimToNull(changeLogFile) != null) {
    changeLogWriter.print(changeLogFile);
  }
 else {
    PrintStream outputStream=System.out;
    changeLogWriter.print(outputStream);
  }
}
