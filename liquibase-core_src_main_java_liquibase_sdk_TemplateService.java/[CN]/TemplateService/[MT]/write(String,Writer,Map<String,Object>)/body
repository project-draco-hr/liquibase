{
  InputStream input=this.getClass().getClassLoader().getResourceAsStream(templatePath);
  try {
    if (input == null) {
      throw new IOException("Template file " + templatePath + " doesn't exist");
    }
    VelocityContext context=new VelocityContext();
    if (contextParams != null) {
      for (      Map.Entry<String,Object> entry : contextParams.entrySet()) {
        context.put(entry.getKey(),entry.getValue());
      }
    }
    Template template=engine.getTemplate(templatePath,"UTF-8");
    template.merge(context,output);
  }
  finally {
    if (input != null) {
      input.close();
    }
  }
}
