{
  Database database=createMock(Database.class);
  JdbcTemplate template=createMock(JdbcTemplate.class);
  RawSqlStatement selectLockStatement=new RawSqlStatement("SELECT LOCK");
  expect(database.getJdbcTemplate()).andReturn(template).anyTimes();
  expect(database.doesChangeLogLockTableExist()).andReturn(true);
  expect(database.getSelectChangeLogLockSQL()).andReturn(selectLockStatement);
  expect(database.getDatabaseChangeLogLockTableName()).andReturn("LOCK_TABLE").anyTimes();
  expect(database.getDatabaseChangeLogTableName()).andReturn("DATABASECHANGELOG").anyTimes();
  expect(database.getDefaultSchemaName()).andReturn(null).anyTimes();
  database.commit();
  expectLastCall();
  expect(template.queryForObject(selectLockStatement,Boolean.class)).andReturn(Boolean.FALSE);
  expect(template.update(isA(UpdateStatement.class))).andReturn(1);
  template.comment("Lock Database");
  expectLastCall();
  replay(database);
  replay(template);
  LockHandler handler=LockHandler.getInstance(database);
  handler.acquireLock();
  verify(database);
  verify(template);
}
