{
  String byTableKey=createKey("getColumns",catalogName,schemaName,tableNamePattern);
  String allTablesKey=createKey("getColumns",catalogName,schemaName);
  List<CachedRow> returnList;
  boolean needToFilter=false;
  if (hasCachedValue(byTableKey)) {
    returnList=getCachedValue(byTableKey);
  }
 else   if (hasCachedValue(allTablesKey)) {
    returnList=getCachedValue(allTablesKey);
    needToFilter=true;
  }
 else {
    tablesOfColumnsFetched++;
    if (shouldCacheAllTableColumns()) {
      returnList=cacheResultSet(allTablesKey,databaseMetaData.getColumns(catalogName,schemaName,null,null));
      needToFilter=true;
    }
 else {
      returnList=cacheResultSet(byTableKey,databaseMetaData.getColumns(catalogName,schemaName,tableNamePattern,null));
      if (returnList.size() == 0) {
        throw new UnexpectedLiquibaseException("No Columns found for table " + tableNamePattern);
      }
    }
  }
  if (columnNamePattern != null || needToFilter) {
    List<CachedRow> filteredList=new ArrayList<CachedRow>();
    for (    CachedRow row : returnList) {
      if (getDatabase().isCaseSensitive()) {
        if (row.getString("TABLE_NAME").equals(tableNamePattern))         if (columnNamePattern == null || row.getString("COLUMN_NAME").equals(columnNamePattern)) {
          filteredList.add(row);
        }
      }
 else {
        if (row.getString("TABLE_NAME").equalsIgnoreCase(tableNamePattern))         if (columnNamePattern == null || row.getString("COLUMN_NAME").equalsIgnoreCase(columnNamePattern)) {
          filteredList.add(row);
        }
      }
    }
    if (filteredList.size() == 0) {
      System.out.println("zero size");
    }
    return filteredList;
  }
 else {
    if (returnList.size() == 0) {
      System.out.println("zero size");
    }
    return returnList;
  }
}
