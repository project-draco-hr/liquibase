{
  return getResultSetCache("getColumns").get(new ResultSetCache.SingleResultSetExtractor(database){
    @Override public ResultSetCache.RowData rowKeyParameters(    CachedRow row){
      return new ResultSetCache.RowData(row.getString("TABLE_CAT"),row.getString("TABLE_SCHEM"),database,row.getString("TABLE_NAME"),row.getString("COLUMN_NAME"));
    }
    @Override public ResultSetCache.RowData wantedKeyParameters(){
      return new ResultSetCache.RowData(catalogName,schemaName,database,tableName,columnName);
    }
    @Override boolean shouldBulkSelect(    String schemaKey,    ResultSetCache resultSetCache){
      if (tableName.equalsIgnoreCase("databasechangelog") || tableName.equalsIgnoreCase("databasechangeloglock")) {
        return false;
      }
      return true;
    }
    @Override public List<CachedRow> fastFetchQuery() throws SQLException, DatabaseException {
      if (database instanceof OracleDatabase) {
        return oracleQuery(false);
      }
      CatalogAndSchema catalogAndSchema=new CatalogAndSchema(catalogName,schemaName).customize(database);
      try {
        return extract(databaseMetaData.getColumns(((AbstractJdbcDatabase)database).getJdbcCatalogName(catalogAndSchema),((AbstractJdbcDatabase)database).getJdbcSchemaName(catalogAndSchema),tableName,columnName));
      }
 catch (      SQLException e) {
        if (shouldReturnEmptyColumns(e)) {
          return new ArrayList<CachedRow>();
        }
 else {
          throw e;
        }
      }
    }
    @Override public List<CachedRow> bulkFetchQuery() throws SQLException, DatabaseException {
      if (database instanceof OracleDatabase) {
        return oracleQuery(true);
      }
      CatalogAndSchema catalogAndSchema=new CatalogAndSchema(catalogName,schemaName).customize(database);
      try {
        return extract(databaseMetaData.getColumns(((AbstractJdbcDatabase)database).getJdbcCatalogName(catalogAndSchema),((AbstractJdbcDatabase)database).getJdbcSchemaName(catalogAndSchema),null,null));
      }
 catch (      SQLException e) {
        if (shouldReturnEmptyColumns(e)) {
          return new ArrayList<CachedRow>();
        }
 else {
          throw e;
        }
      }
    }
    protected boolean shouldReturnEmptyColumns(    SQLException e){
      return e.getMessage().contains("references invalid table");
    }
    protected List<CachedRow> oracleQuery(    boolean bulk) throws DatabaseException, SQLException {
      CatalogAndSchema catalogAndSchema=new CatalogAndSchema(catalogName,schemaName).customize(database);
      String sql="select NULL AS TABLE_CAT, OWNER AS TABLE_SCHEM, 'NO' as IS_AUTOINCREMENT, cc.COMMENTS AS REMARKS,\n" + "OWNER, TABLE_NAME, COLUMN_NAME, DATA_TYPE, DATA_TYPE_MOD, DATA_TYPE_OWNER, " + "DECODE( CHAR_USED, 'C',CHAR_LENGTH, DATA_LENGTH ) as DATA_LENGTH, "+ "DATA_PRECISION, DATA_SCALE, NULLABLE, COLUMN_ID, DEFAULT_LENGTH, "+ "DATA_DEFAULT, NUM_DISTINCT, LOW_VALUE, HIGH_VALUE, DENSITY, NUM_NULLS, "+ "NUM_BUCKETS, LAST_ANALYZED, SAMPLE_SIZE, CHARACTER_SET_NAME, "+ "CHAR_COL_DECL_LENGTH, GLOBAL_STATS, USER_STATS, AVG_COL_LEN, CHAR_LENGTH, "+ "CHAR_USED, V80_FMT_IMAGE, DATA_UPGRADED, HISTOGRAM, VIRTUAL_COLUMN\n"+ "FROM ALL_TAB_COLS c "+ "JOIN ALL_COL_COMMENTS cc USING ( OWNER, TABLE_NAME, COLUMN_NAME ) "+ "WHERE OWNER='" + ((AbstractJdbcDatabase)database).getJdbcSchemaName(catalogAndSchema) + "' AND hidden_column='NO'";
      if (!bulk) {
        if (tableName != null) {
          sql+=" AND TABLE_NAME='" + database.escapeObjectName(tableName,Table.class) + "'";
        }
        if (columnName != null) {
          sql+=" AND COLUMN_NAME='" + database.escapeObjectName(columnName,Column.class) + "'";
        }
      }
      sql+=" ORDER BY OWNER, TABLE_NAME, c.COLUMN_ID";
      return this.executeAndExtract(sql,database);
    }
  }
);
}
