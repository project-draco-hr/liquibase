{
  for (  Column column : getChangedColumns()) {
    if (!shouldModifyColumn(column)) {
      continue;
    }
    boolean foundDifference=false;
    Column referenceColumn=referenceSnapshot.getColumn(column.getTable().getName(),column.getName());
    if (column.isDataTypeDifferent(referenceColumn)) {
      ModifyDataTypeChange change=new ModifyDataTypeChange();
      change.setTableName(column.getTable().getName());
      change.setSchemaName(column.getTable().getSchema());
      change.setColumnName(column.getName());
      change.setNewDataType(referenceColumn.getDataTypeString(targetSnapshot.getDatabase()));
      changes.add(generateChangeSet(change));
      foundDifference=true;
    }
    if (column.isNullabilityDifferent(referenceColumn)) {
      if (referenceColumn.isNullable() == null || referenceColumn.isNullable()) {
        DropNotNullConstraintChange change=new DropNotNullConstraintChange();
        change.setTableName(column.getTable().getName());
        change.setSchemaName(column.getTable().getSchema());
        change.setColumnName(column.getName());
        change.setColumnDataType(referenceColumn.getDataTypeString(targetSnapshot.getDatabase()));
        changes.add(generateChangeSet(change));
        foundDifference=true;
      }
 else {
        AddNotNullConstraintChange change=new AddNotNullConstraintChange();
        change.setTableName(column.getTable().getName());
        change.setSchemaName(column.getTable().getSchema());
        change.setColumnName(column.getName());
        change.setColumnDataType(referenceColumn.getDataTypeString(targetSnapshot.getDatabase()));
        changes.add(generateChangeSet(change));
        foundDifference=true;
      }
    }
    if (!foundDifference) {
      throw new RuntimeException("Unknown difference");
    }
  }
}
