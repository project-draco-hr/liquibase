{
  for (  Column column : getChangedColumns()) {
    if (!shouldModifyColumn(column)) {
      continue;
    }
    TypeConverter targetTypeConverter=TypeConverterFactory.getInstance().findTypeConverter(targetSnapshot.getDatabase());
    boolean foundDifference=false;
    Column referenceColumn=referenceSnapshot.getColumn(column.getTable().getName(),column.getName());
    if (column.isDataTypeDifferent(referenceColumn)) {
      ModifyDataTypeChange change=new ModifyDataTypeChange();
      change.setTableName(column.getTable().getName());
      change.setSchemaName(column.getTable().getSchema());
      change.setColumnName(column.getName());
      change.setNewDataType(targetTypeConverter.convertToDatabaseTypeString(referenceColumn,targetSnapshot.getDatabase()));
      changes.add(generateChangeSet(change));
      foundDifference=true;
    }
    if (column.isNullabilityDifferent(referenceColumn)) {
      if (referenceColumn.isNullable() == null || referenceColumn.isNullable()) {
        DropNotNullConstraintChange change=new DropNotNullConstraintChange();
        change.setTableName(column.getTable().getName());
        change.setSchemaName(column.getTable().getSchema());
        change.setColumnName(column.getName());
        change.setColumnDataType(targetTypeConverter.convertToDatabaseTypeString(referenceColumn,targetSnapshot.getDatabase()));
        changes.add(generateChangeSet(change));
        foundDifference=true;
      }
 else {
        AddNotNullConstraintChange change=new AddNotNullConstraintChange();
        change.setTableName(column.getTable().getName());
        change.setSchemaName(column.getTable().getSchema());
        change.setColumnName(column.getName());
        change.setColumnDataType(targetTypeConverter.convertToDatabaseTypeString(referenceColumn,targetSnapshot.getDatabase()));
        Object defaultValue=column.getDefaultValue();
        String defaultValueString;
        if (defaultValue != null) {
          defaultValueString=targetTypeConverter.getDataType(defaultValue).convertObjectToString(defaultValue,targetSnapshot.getDatabase());
          if (defaultValueString != null) {
            change.setDefaultNullValue(defaultValueString);
          }
        }
        changes.add(generateChangeSet(change));
        foundDifference=true;
      }
    }
    if (!foundDifference) {
      throw new RuntimeException("Unknown difference");
    }
  }
}
