{
  Database database=snapshot.getDatabase();
  updateListeners("Reading unique constraints for " + database.toString() + " ...");
  List<UniqueConstraint> foundUC=new ArrayList<UniqueConstraint>();
  PreparedStatement statement=null;
  ResultSet rs=null;
  try {
    statement=((JdbcConnection)database.getConnection()).getUnderlyingConnection().prepareStatement("select pgc.conname, pgc.conrelid, pgc.conkey, pgcl.relname from pg_constraint pgc inner join pg_class pgcl on pgcl.oid = pgc.conrelid and pgcl.relkind ='r' where contype = 'u'");
    rs=statement.executeQuery();
    while (rs.next()) {
      String constraintName=rs.getString("conname");
      long conrelid=rs.getLong("conrelid");
      Array keys=rs.getArray("conkey");
      String tableName=rs.getString("relname");
      UniqueConstraint constraintInformation=new UniqueConstraint();
      constraintInformation.setName(constraintName);
      if (!database.isSystemTable(schema,tableName) && !database.isLiquibaseTable(tableName)) {
        Table table=snapshot.getDatabaseObject(schema,tableName,Table.class);
        if (table == null) {
          continue;
        }
        constraintInformation.setTable(table);
        getColumnsForUniqueConstraint(database,conrelid,keys,constraintInformation);
        foundUC.add(constraintInformation);
      }
    }
    snapshot.addDatabaseObjects(foundUC.toArray(new UniqueConstraint[foundUC.size()]));
  }
  finally {
    try {
      if (rs != null) {
        rs.close();
      }
    }
 catch (    SQLException ignored) {
    }
    if (statement != null) {
      statement.close();
    }
  }
}
