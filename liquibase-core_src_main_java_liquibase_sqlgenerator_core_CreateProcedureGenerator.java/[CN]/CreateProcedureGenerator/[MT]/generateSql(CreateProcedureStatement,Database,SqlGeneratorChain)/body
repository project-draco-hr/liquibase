{
  List<Sql> sql=new ArrayList<Sql>();
  String procedureText=addSchemaToText(statement.getProcedureText(),statement.getSchemaName(),"PROCEDURE",database);
  if (statement.getReplaceIfExists() != null && statement.getReplaceIfExists()) {
    String fullyQualifiedName=database.escapeObjectName(statement.getProcedureName(),StoredProcedure.class);
    String schemaName=statement.getSchemaName();
    if (schemaName == null) {
      schemaName=database.getDefaultSchemaName();
    }
    if (schemaName != null) {
      fullyQualifiedName=database.escapeObjectName(schemaName,Schema.class) + "." + fullyQualifiedName;
    }
    sql.add(new UnparsedSql("if object_id('" + fullyQualifiedName + "', 'p') is null exec ('create procedure "+ fullyQualifiedName+ " as select 1 a')"));
    String oldProcedureText=procedureText;
    procedureText=procedureText.replaceFirst("(?i)create\\s+procedure","ALTER PROCEDURE");
    if (oldProcedureText.equals(procedureText)) {
      procedureText=procedureText.replaceFirst("(?i)create\\s+proc ","ALTER PROCEDURE");
    }
  }
  sql.add(new UnparsedSql(procedureText,statement.getEndDelimiter()));
  surroundWithSchemaSets(sql,statement.getSchemaName(),database);
  return sql.toArray(new Sql[sql.size()]);
}
