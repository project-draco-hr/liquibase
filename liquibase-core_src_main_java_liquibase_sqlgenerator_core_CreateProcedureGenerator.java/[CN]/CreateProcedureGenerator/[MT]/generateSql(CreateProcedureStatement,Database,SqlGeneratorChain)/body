{
  List<Sql> sql=new ArrayList<Sql>();
  String procedureText=statement.getProcedureText();
  if (statement.getReplaceIfExists() != null && statement.getReplaceIfExists()) {
    String fullyQualifiedName=database.escapeObjectName(statement.getProcedureName(),StoredProcedure.class);
    String schemaName=statement.getSchemaName();
    if (schemaName == null) {
      schemaName=database.getDefaultSchemaName();
    }
    if (schemaName != null) {
      fullyQualifiedName=database.escapeObjectName(schemaName,Schema.class) + "." + fullyQualifiedName;
    }
    sql.add(new UnparsedSql("if object_id('" + fullyQualifiedName + "', 'p') is null exec ('create procedure "+ fullyQualifiedName+ " as select 1 a')"));
    procedureText=procedureText.replaceFirst("(?i)create\\s+procedure","ALTER PROCEDURE");
  }
  sql.add(new UnparsedSql(procedureText,statement.getEndDelimiter()));
  return sql.toArray(new Sql[sql.size()]);
}
