{
  try {
    final String url=connectionConfig.getUrl();
    if (connectionsAttempted.containsKey(url)) {
      JdbcConnection connection=(JdbcConnection)connectionsByUrl.get(url);
      if (connection == null) {
        return null;
      }
 else       if (connection.getUnderlyingConnection().isClosed()) {
        connectionsByUrl.put(url,openDatabaseConnection(connectionConfig));
      }
      return connectionsByUrl.get(url);
    }
    connectionsAttempted.put(url,Boolean.TRUE);
    final DatabaseConnection connection=openDatabaseConnection(connectionConfig);
    if (connection == null) {
      return null;
    }
    connectionsByUrl.put(url,connection);
    Runtime.getRuntime().addShutdownHook(new Thread(new Runnable(){
      @Override public void run(){
        try {
          try {
            if (!((JdbcConnection)connection).getUnderlyingConnection().getAutoCommit()) {
              ((JdbcConnection)connection).getUnderlyingConnection().rollback();
            }
          }
 catch (          SQLException e) {
            ;
          }
          ((JdbcConnection)connection).getUnderlyingConnection().close();
        }
 catch (        SQLException e) {
          System.out.println("Could not close " + url);
          e.printStackTrace();
        }
      }
    }
));
    return connectionsByUrl.get(url);
  }
 catch (  Exception e) {
    e.printStackTrace();
    return null;
  }
}
