{
  Statement statement=null;
  Connection connection=getConnection();
  ResultSet rs=null;
  changeLogTableExists=true;
  try {
    rs=connection.getMetaData().getTables(getCatalogName(),getSchemaName(),getDatabaseChangeLogTableName(),null);
    if (!rs.next()) {
      String createTableStatement=("create table DATABASECHANGELOG (id varchar(255) not null, author varchar(255) not null, filename varchar(255) not null, dateExecuted " + getDateTimeType() + " not null, md5sum varchar(32), primary key(id, author, filename))").toUpperCase();
      if (migrator.getMode().equals(Migrator.EXECUTE_MODE)) {
        statement=connection.createStatement();
        statement.executeUpdate(createTableStatement);
        connection.commit();
        log.info("Created database history table with name: DATABASECHANGELOG");
      }
 else {
        migrator.getOutputSQLWriter().append(createTableStatement + ";\n\n");
        changeLogTableExists=false;
      }
    }
  }
  finally {
    if (statement != null) {
      statement.close();
    }
    if (rs != null) {
      rs.close();
    }
  }
}
