{
  StringBuffer sql=new StringBuffer("UPDATE " + database.escapeTableName(statement.getCatalogName(),statement.getSchemaName(),statement.getTableName()) + " SET");
  for (  String column : statement.getNewColumnValues().keySet()) {
    sql.append(" ").append(database.escapeColumnName(statement.getCatalogName(),statement.getSchemaName(),statement.getTableName(),column)).append(" = ");
    sql.append(convertToString(statement.getNewColumnValues().get(column),database));
    sql.append(",");
  }
  int lastComma=sql.lastIndexOf(",");
  if (lastComma >= 0) {
    sql.deleteCharAt(lastComma);
  }
  if (statement.getWhereClause() != null) {
    String fixedWhereClause="WHERE " + statement.getWhereClause().trim();
    Matcher matcher=Pattern.compile(":name|\\?|:value").matcher(fixedWhereClause);
    StringBuffer sb=new StringBuffer();
    Iterator<String> columnNameIter=statement.getWhereColumnNames().iterator();
    Iterator<Object> paramIter=statement.getWhereParameters().iterator();
    while (matcher.find()) {
      if (matcher.group().equals(":name")) {
        while (columnNameIter.hasNext()) {
          String columnName=columnNameIter.next();
          if (columnName == null) {
            continue;
          }
          matcher.appendReplacement(sb,Matcher.quoteReplacement(database.escapeObjectName(columnName,Column.class)));
          break;
        }
      }
 else       if (paramIter.hasNext()) {
        Object param=paramIter.next();
        matcher.appendReplacement(sb,Matcher.quoteReplacement(DataTypeFactory.getInstance().fromObject(param,database).objectToSql(param,database)));
      }
    }
    matcher.appendTail(sb);
    fixedWhereClause=sb.toString();
    sql.append(" ").append(fixedWhereClause);
  }
  return new Sql[]{new UnparsedSql(sql.toString(),getAffectedTable(statement))};
}
