{
  Executor oldTemplate=database.getJdbcTemplate();
  JdbcOutputTemplate outputTemplate=new JdbcOutputTemplate(output,database);
  database.setJdbcTemplate(outputTemplate);
  outputHeader("Update Database Script");
  LockHandler lockHandler=LockHandler.getInstance(database);
  lockHandler.waitForLock();
  try {
    update(contexts);
    output.flush();
  }
 catch (  IOException e) {
    throw new LiquibaseException(e);
  }
 finally {
    lockHandler.releaseLock();
  }
  database.setJdbcTemplate(oldTemplate);
}
