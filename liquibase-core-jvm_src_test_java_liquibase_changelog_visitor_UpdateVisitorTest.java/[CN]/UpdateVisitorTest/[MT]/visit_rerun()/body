{
  ChangeSet changeSet=createMock(ChangeSet.class);
  Database database=createMock(Database.class);
  expect(changeSet.execute(database)).andReturn(true);
  expect(database.getRunStatus(changeSet)).andReturn(ChangeSet.RunStatus.ALREADY_RAN);
  database.markChangeSetAsReRan(changeSet);
  expectLastCall();
  database.commit();
  expectLastCall();
  replay(changeSet);
  replay(database);
  UpdateVisitor visitor=new UpdateVisitor(database);
  visitor.visit(changeSet,database);
  verify(database);
  verify(changeSet);
}
