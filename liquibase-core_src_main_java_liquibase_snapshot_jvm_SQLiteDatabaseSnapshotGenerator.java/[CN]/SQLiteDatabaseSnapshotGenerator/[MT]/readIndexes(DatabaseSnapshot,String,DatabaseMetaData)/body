{
  Database database=snapshot.getDatabase();
  updateListeners("Reading indexes for " + database.toString() + " ...");
  for (  Table table : snapshot.getTables()) {
    ResultSet rs=null;
    Statement statement=null;
    Map<String,Index> indexMap;
    try {
      indexMap=new HashMap<String,Index>();
      statement=((JdbcConnection)database.getConnection()).getUnderlyingConnection().createStatement();
      String sql="PRAGMA index_list(" + table.getName() + ");";
      try {
        rs=statement.executeQuery(sql);
      }
 catch (      SQLException e) {
        if (!e.getMessage().equals("query does not return ResultSet")) {
          System.err.println(e);
        }
      }
      while ((rs != null) && rs.next()) {
        String index_name=rs.getString("name");
        boolean index_unique=rs.getBoolean("unique");
        sql="PRAGMA index_info(" + index_name + ");";
        Statement statement_2=null;
        ResultSet rs_2=null;
        try {
          statement_2=((JdbcConnection)database.getConnection()).getUnderlyingConnection().createStatement();
          rs_2=statement_2.executeQuery(sql);
          while ((rs_2 != null) && rs_2.next()) {
            int index_column_seqno=rs_2.getInt("seqno");
            String index_column_name=rs_2.getString("name");
            if (index_unique) {
              Column column=snapshot.getColumn(table.getName(),index_column_name);
              column.setUnique(true);
            }
 else {
              Index indexInformation;
              if (indexMap.containsKey(index_name)) {
                indexInformation=indexMap.get(index_name);
              }
 else {
                indexInformation=new Index();
                indexInformation.setTable(table);
                indexInformation.setName(index_name);
                indexInformation.setFilterCondition("");
                indexMap.put(index_name,indexInformation);
              }
              indexInformation.getColumns().add(index_column_seqno,index_column_name);
            }
          }
        }
  finally {
          if (rs_2 != null) {
            try {
              rs_2.close();
            }
 catch (            SQLException ignored) {
            }
          }
          if (statement_2 != null) {
            try {
              statement_2.close();
            }
 catch (            SQLException ignored) {
            }
          }
        }
      }
    }
  finally {
      if (rs != null) {
        try {
          rs.close();
        }
 catch (        SQLException ignored) {
        }
      }
      if (statement != null) {
        try {
          statement.close();
        }
 catch (        SQLException ignored) {
        }
      }
    }
    for (    Map.Entry<String,Index> entry : indexMap.entrySet()) {
      snapshot.getIndexes().add(entry.getValue());
    }
  }
  Set<Index> indexesToRemove=new HashSet<Index>();
  for (  Index index : snapshot.getIndexes()) {
    for (    PrimaryKey pk : snapshot.getPrimaryKeys()) {
      if (index.getTable().getName().equalsIgnoreCase(pk.getTable().getName()) && index.getColumnNames().equals(pk.getColumnNames())) {
        indexesToRemove.add(index);
      }
    }
  }
  snapshot.getIndexes().removeAll(indexesToRemove);
}
