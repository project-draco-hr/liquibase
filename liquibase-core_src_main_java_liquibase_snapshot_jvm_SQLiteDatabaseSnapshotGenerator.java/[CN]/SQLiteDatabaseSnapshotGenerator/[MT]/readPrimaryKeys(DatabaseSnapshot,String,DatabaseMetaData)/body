{
  Database database=snapshot.getDatabase();
  updateListeners("Reading primary keys for " + database.toString() + " ...");
  List<PrimaryKey> foundPKs=new ArrayList<PrimaryKey>();
  for (  Table table : snapshot.getTables()) {
    ResultSet rs=databaseMetaData.getPrimaryKeys(database.convertRequestedSchemaToCatalog(schema),database.convertRequestedSchemaToSchema(schema),table.getName());
    while (rs.next()) {
      String tableName=rs.getString("TABLE_NAME");
      String columnName=rs.getString("COLUMN_NAME");
      short position=rs.getShort("KEY_SEQ");
      if (!(database instanceof SQLiteDatabase)) {
        position-=1;
      }
      boolean foundExistingPK=false;
      for (      PrimaryKey pk : foundPKs) {
        if (pk.getTable().getName().equals(tableName)) {
          pk.addColumnName(position,columnName);
          foundExistingPK=true;
        }
      }
      if (!foundExistingPK) {
        PrimaryKey primaryKey=new PrimaryKey();
        primaryKey.setTable(table);
        primaryKey.addColumnName(position,columnName);
        primaryKey.setName(rs.getString("PK_NAME"));
        foundPKs.add(primaryKey);
      }
    }
    rs.close();
  }
  snapshot.getPrimaryKeys().addAll(foundPKs);
}
