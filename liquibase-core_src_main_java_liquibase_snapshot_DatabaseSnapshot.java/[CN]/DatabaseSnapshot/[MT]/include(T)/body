{
  T existing=get(example);
  if (existing != null) {
    return existing;
  }
  if (isKnownNull(example)) {
    return null;
  }
  SnapshotGeneratorChain chain=createGeneratorChain(example.getClass(),database);
  T object=chain.snapshot(example,this);
  if (object == null) {
    Set<DatabaseObject> collection=knownNull.get(example.getClass());
    if (collection == null) {
      collection=new HashSet<DatabaseObject>();
      knownNull.put(example.getClass(),collection);
    }
    collection.add(example);
  }
 else {
    Set<DatabaseObject> collection=allFound.get(object.getClass());
    if (collection == null) {
      collection=new HashSet<DatabaseObject>();
      allFound.put(object.getClass(),collection);
    }
    collection.add(object);
    includeNestedObjects(object);
  }
  return object;
}
