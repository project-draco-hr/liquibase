{
  if (example == null) {
    return null;
  }
  if (database.isSystemObject(example)) {
    return null;
  }
  if (example instanceof Schema && example.getName() == null && (((Schema)example).getCatalog() == null || ((Schema)example).getCatalogName() == null)) {
    CatalogAndSchema catalogAndSchema=database.correctSchema(((Schema)example).toCatalogAndSchema());
    example=(T)new Schema(catalogAndSchema.getCatalogName(),catalogAndSchema.getSchemaName());
  }
  if (!snapshotControl.shouldInclude(example.getClass())) {
    return example;
  }
  T existing=get(example);
  if (existing != null) {
    return existing;
  }
  if (isKnownNull(example)) {
    return null;
  }
  SnapshotGeneratorChain chain=createGeneratorChain(example.getClass(),database);
  T object=chain.snapshot(example,this);
  if (object == null) {
    Set<DatabaseObject> collection=knownNull.get(example.getClass());
    if (collection == null) {
      collection=new HashSet<DatabaseObject>();
      knownNull.put(example.getClass(),collection);
    }
    collection.add(example);
  }
 else {
    Map<String,Set<DatabaseObject>> collectionMap=allFoundByHash.get(object.getClass());
    if (collectionMap == null) {
      collectionMap=new HashMap<String,Set<DatabaseObject>>();
      allFoundByHash.put(object.getClass(),collectionMap);
    }
    String hash=DatabaseObjectComparatorFactory.getInstance().hash(object,database);
    Set<DatabaseObject> collection=collectionMap.get(hash);
    if (collection == null) {
      collection=new HashSet<DatabaseObject>();
      collectionMap.put(hash,collection);
    }
    collection.add(object);
    try {
      includeNestedObjects(object);
    }
 catch (    InstantiationException e) {
      throw new UnexpectedLiquibaseException(e);
    }
catch (    IllegalAccessException e) {
      throw new UnexpectedLiquibaseException(e);
    }
  }
  return object;
}
