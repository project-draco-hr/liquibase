{
  System.out.println("Viewing all auction item info");
  Session s=factory.openSession();
  Transaction tx=null;
  try {
    tx=s.beginTransaction();
    List auctions=s.createQuery("select new AuctionInfo( item.id, item.description, item.ends, max(bid.amount) ) " + "from AuctionItem item " + "left join item.bids bid "+ "group by item.id, item.description, item.ends "+ "order by item.ends desc").setMaxResults(100).list();
    Iterator iter=auctions.iterator();
    while (iter.hasNext()) {
      AuctionInfo ai=(AuctionInfo)iter.next();
      System.out.println("Auction: " + ai.getId() + " - "+ ai.getDescription()+ ", ends: "+ ai.getEnds()+ ", highest bid: "+ ai.getMaxAmount());
    }
    System.out.println();
    tx.commit();
  }
 catch (  Exception e) {
    if (tx != null)     tx.rollback();
    throw e;
  }
 finally {
    s.close();
  }
}
