{
  if (referenceSnapshot == null) {
    referenceSnapshot=DatabaseSnapshotGeneratorFactory.getInstance().createSnapshot(referenceDatabase,null,statusListeners);
  }
  if (targetSnapshot == null) {
    if (targetDatabase == null) {
      targetSnapshot=new DatabaseSnapshot(referenceDatabase,null);
    }
 else {
      targetSnapshot=DatabaseSnapshotGeneratorFactory.getInstance().createSnapshot(targetDatabase,null,statusListeners);
    }
  }
  DiffResult diffResult=new DiffResult(referenceSnapshot,targetSnapshot);
  checkVersionInfo(diffResult);
  if (shouldDiffTables()) {
    checkTables(diffResult);
  }
  if (shouldDiffViews()) {
    checkViews(diffResult);
  }
  if (shouldDiffColumns()) {
    checkColumns(diffResult);
  }
  if (shouldDiffForeignKeys()) {
    checkForeignKeys(diffResult);
  }
  if (shouldDiffPrimaryKeys()) {
    checkPrimaryKeys(diffResult);
  }
  if (shouldDiffUniqueConstraints()) {
    checkUniqueConstraints(diffResult);
  }
  if (shouldDiffIndexes()) {
    checkIndexes(diffResult);
  }
  if (shouldDiffSequences()) {
    checkSequences(diffResult);
  }
  diffResult.setDiffData(shouldDiffData());
  return diffResult;
}
