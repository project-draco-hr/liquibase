{
  LockService lockService=LockService.getInstance(database);
  lockService.waitForLock();
  changeLogParameters.setContexts(StringUtils.splitAndTrim(contexts,","));
  try {
    DatabaseChangeLog changeLog=ChangeLogParserFactory.getInstance().getParser(changeLogFile).parse(changeLogFile,changeLogParameters,resourceAccessor);
    checkDatabaseChangeLogTable(true,changeLog);
    changeLog.validate(database);
    ChangeLogIterator changeLogIterator=new ChangeLogIterator(changeLog,new ShouldRunChangeSetFilter(database),new ContextChangeSetFilter(contexts),new DbmsChangeSetFilter(database));
    changeLogIterator.run(new UpdateVisitor(database),database);
  }
  finally {
    try {
      lockService.releaseLock();
    }
 catch (    LockException e) {
      log.severe("Could not release lock",e);
    }
  }
}
