{
  LockService lockService=LockServiceFactory.getInstance().getLockService(database);
  lockService.waitForLock();
  changeLogParameters.setContexts(contexts);
  try {
    ChangeLogParser parser=ChangeLogParserFactory.getInstance().getParser(changeLogFile,resourceAccessor);
    DatabaseChangeLog changeLog=parser.parse(changeLogFile,changeLogParameters,resourceAccessor);
    changeLog.validate(database,contexts);
    checkLiquibaseTables(true,changeLog,contexts);
    ChangeLogIterator changeLogIterator=getStandardChangelogIterator(contexts,changeLog);
    changeLogIterator.run(createUpdateVisitor(),database);
  }
  finally {
    database.setObjectQuotingStrategy(ObjectQuotingStrategy.LEGACY);
    try {
      lockService.releaseLock();
    }
 catch (    LockException e) {
      log.severe("Could not release lock",e);
    }
  }
}
