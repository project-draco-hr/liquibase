{
  contexts=StringUtils.trimToNull(contexts);
  changeLogParameters.setContexts(StringUtils.splitAndTrim(contexts,","));
  Executor oldTemplate=ExecutorService.getInstance().getExecutor(database);
  LoggingExecutor loggingExecutor=new LoggingExecutor(ExecutorService.getInstance().getExecutor(database),output,database);
  ExecutorService.getInstance().setExecutor(database,loggingExecutor);
  outputHeader("Update Database Script");
  LockService lockService=getLockService();
  lockService.waitForLock();
  try {
    update(contexts);
    output.flush();
  }
 catch (  IOException e) {
    throw new LiquibaseException(e);
  }
 finally {
    lockService.releaseLock();
  }
  ExecutorService.getInstance().setExecutor(database,oldTemplate);
}
