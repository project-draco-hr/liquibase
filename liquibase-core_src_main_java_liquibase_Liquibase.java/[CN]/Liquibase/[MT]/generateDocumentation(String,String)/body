{
  contexts=StringUtils.trimToNull(contexts);
  log.info("Generating Database Documentation");
  changeLogParameters.setContexts(StringUtils.splitAndTrim(contexts,","));
  LockService lockService=LockService.getInstance(database);
  lockService.waitForLock();
  try {
    DatabaseChangeLog changeLog=ChangeLogParserFactory.getInstance().getParser(changeLogFile,resourceAccessor).parse(changeLogFile,changeLogParameters,resourceAccessor);
    checkDatabaseChangeLogTable(false,changeLog,null);
    String[] splitContexts=null;
    if (StringUtils.trimToNull(contexts) != null) {
      splitContexts=contexts.split(",");
    }
    changeLog.validate(database,splitContexts);
    ChangeLogIterator logIterator=new ChangeLogIterator(changeLog,new DbmsChangeSetFilter(database));
    DBDocVisitor visitor=new DBDocVisitor(database);
    logIterator.run(visitor,database);
    visitor.writeHTML(new File(outputDirectory),resourceAccessor);
  }
 catch (  IOException e) {
    throw new LiquibaseException(e);
  }
 finally {
    lockService.releaseLock();
  }
}
