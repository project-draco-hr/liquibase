{
  openConnection(url);
  if (database != null) {
    if (!database.getConnection().getAutoCommit()) {
      database.rollback();
    }
    DatabaseSnapshotGeneratorFactory.resetAll();
    ExecutorService.getInstance().reset();
    LockService.resetAll();
    database.checkDatabaseChangeLogLockTable();
    if (database.getConnection() != null) {
      String dropTableCommand="drop table " + database.escapeTableName(database.getLiquibaseCatalogName(),database.getLiquibaseSchemaName(),database.getDatabaseChangeLogLockTableName());
      ((JdbcConnection)database.getConnection()).getUnderlyingConnection().createStatement().executeUpdate(dropTableCommand);
      database.commit();
    }
    DatabaseSnapshotGeneratorFactory.resetAll();
    LockService.getInstance(database).forceReleaseLock();
    database.dropDatabaseObjects(Schema.DEFAULT);
    if (database.supportsSchemas()) {
      database.dropDatabaseObjects(new Schema((String)null,DatabaseTestContext.ALT_SCHEMA));
    }
    if (supportsAltCatalogTests()) {
      if (database.supportsSchemas() && database.supportsCatalogs()) {
        database.dropDatabaseObjects(new Schema(DatabaseTestContext.ALT_CATALOG,DatabaseTestContext.ALT_SCHEMA));
      }
 else       if (database.supportsCatalogs()) {
        database.dropDatabaseObjects(new Schema((String)null,DatabaseTestContext.ALT_SCHEMA));
      }
    }
    database.commit();
    DatabaseSnapshotGeneratorFactory.resetAll();
  }
}
