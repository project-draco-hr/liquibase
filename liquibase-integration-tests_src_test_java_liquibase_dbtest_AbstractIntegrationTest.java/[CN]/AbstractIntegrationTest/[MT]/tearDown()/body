{
  if (database != null) {
    if (shouldRollBack()) {
      database.rollback();
    }
    ExecutorService.getInstance().clearExecutor(database);
    database.setDefaultSchemaName(null);
    database.close();
  }
  ServiceLocator.reset();
  DatabaseSnapshotGeneratorFactory.resetAll();
  DatabaseFactory.reset();
}
